<?xml version="1.0" encoding="UTF-8" ?>

<project name="test_project" default="usage" basedir=".">

    <description>Migration</description>

    <!-- set global properties for this build -->
    <property name="src.dir" location="src" />
    <property name="lib.dir" location="lib" />
    <property name="build.dir" location="E:/hadoop_build/test/build" />
    <property name="dist.dir" location="E:/hadoop_build/test/dist" />

    <property name="scp.host" value="50.22.226.222" />
    <property name="scp.dist" value="/home/hadoop/test_jars" />
    <property name="scp.user" value="hadoop" />
    <property name="scp.passwd" value="xingyun" />

    <property name="scp.product.host" value="50.22.226.220" />
    <property name="scp.product.dist" value="/home/hadoop/wuzijing" />
    <property name="scp.product.user" value="hadoop" />
    <property name="scp.product.passwd" value="jd82U*#jkd9J*#jfduf" />

    <pathconvert property="libs.project" pathsep=" ">
        <mapper>
            <chainedmapper>
                <flattenmapper />
                <globmapper from="*" to="lib/*" />
            </chainedmapper>
        </mapper>
        <path>
            <fileset dir="${lib.dir}">
                <include name="**/*.jar" />
            </fileset>
        </path>
    </pathconvert>

    <path id="project.classpath">
        <fileset dir="${lib.dir}" includes="*.jar" />
    </path>

    <target name="usage">
        <echo>===== Migration =====</echo>
    </target>

    <target name="init">
        <mkdir dir="${build.dir}" />
        <mkdir dir="${dist.dir}" />
    </target>

    <target name="clean">
        <delete dir="${build.dir}" />
        <delete dir="${dist.dir}" />
    </target>

    <target name="compile" depends="init" description="compile the source ">
        <javac srcdir="${src.dir}" destdir="${build.dir}" classpathref="project.classpath" includeantruntime="on" />
    </target>

    <target name="MIGRATION" depends="compile">
        <jar jarfile="${dist.dir}/migration.jar" basedir="${build.dir}">
            <manifest>
                <attribute name="Main-Class" value="com.xingcloud.migrate.Migrater" />
            </manifest>
        </jar>
    </target>

    <target name="REMOTE_DIST_TEST" depends="init">
        <echo>${scp.user}@${scp.host}:${scp.dist}</echo>
        <scp todir="${scp.user}@${scp.host}:${scp.dist}" password="${scp.passwd}" trust="true">
            <fileset dir="${dist.dir}">
                <include name="**/*.jar" />
            </fileset>
        </scp>
    </target>

    <target name="REMOTE_DIST_PRODUCT" depends="init">
        <echo>${scp.product.user}@${scp.product.host}:${scp.product.dist}</echo>
        <scp todir="${scp.product.user}@${scp.product.host}:${scp.product.dist}" password="${scp.product.passwd}" trust="true">
            <fileset dir="${dist.dir}">
                <include name="**/*.jar" />
            </fileset>
        </scp>
    </target>
</project>